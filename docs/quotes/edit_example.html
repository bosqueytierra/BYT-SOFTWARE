<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Editar Cotización - Ejemplo</title>
  <script>
    // Reemplaza estas variables para pruebas locales. En producción usa env vars en Vercel/GitHub.
    window.SUPABASE_URL = 'https://lpxsqxgrxdssjoqtdgve.supabase.co';
    window.SUPABASE_ANON_KEY = 'TU_ANON_KEY_REAL';
  </script>
</head>
<body>
  <h1>Editar Cotización (ejemplo)</h1>
  <div id="lockStatus">Estado: ---</div>

  <form id="quoteForm">
    <label>Título: <input name="title" type="text" /></label><br/>
    <label>Cliente: <input name="client_name" type="text" /></label><br/>
    <label>Observaciones: <textarea name="observaciones"></textarea></label><br/>
    <button type="button" id="btnSave">Guardar ahora</button>
  </form>

  <script type="module">
    import { initWizard } from '/src/js/wizard.js';

    // Obtener id desde query string o usar el UUID de prueba
    function getQuoteIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id') || '0f931c2a-dd9b-4d8c-aa3f-1448fbe5709f';
    }

    const quoteId = getQuoteIdFromUrl();

    const wizard = initWizard({
      quoteId,
      formSelector: '#quoteForm',
      autosaveInterval: 15000, // 15s
      lockTTL: 300,
      onStatus: msg => {
        document.getElementById('lockStatus').textContent = msg;
      }
    });

    document.getElementById('btnSave').addEventListener('click', async () => {
      const res = await wizard.saveNow();
      console.log('saveNow result', res);
    });
  </script>
</body>
</html>